# ============================================================
# CODE MIGRATION SYSTEM - Configuration
# ============================================================
# Chạy với profile:
#   Coordinator: --spring.profiles.active=coordinator
#   Worker:      --spring.profiles.active=worker
# ============================================================

spring:
    application:
        name: code-migration-system

    # H2 Database Configuration
    datasource:
        url: jdbc:h2:file:./data/migration-db
        driver-class-name: org.h2.Driver
        username: sa
        password:

    h2:
        console:
            enabled: true
            path: /h2-console

    jpa:
        database-platform: org.hibernate.dialect.H2Dialect
        hibernate:
            ddl-auto: update
        show-sql: false
        properties:
            hibernate:
                format_sql: true

# Logging mặc định
logging:
    level:
        com.htpt.migration: DEBUG
        org.springframework.web.socket: INFO
        org.hibernate.SQL: DEBUG
        org.hibernate.type.descriptor.sql.BasicBinder: TRACE


# ============================================================
# COORDINATOR PROFILE
# Điều phối cluster, quản lý nodes, cung cấp API & WebSocket
# ============================================================
---
spring:
    config:
        activate:
            on-profile: coordinator

server:
    port: 8080

node:
    mode: coordinator

logging:
    level:
        com.htpt.migration: INFO


# ============================================================
# WORKER PROFILE
# Kết nối đến Coordinator, thực thi code, gửi metrics
# ============================================================
---
spring:
    config:
        activate:
            on-profile: worker

    # Disable JPA for Worker nodes
    autoconfigure:
        exclude:
            - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
            - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
            - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration

server:
    port: ${SERVER_PORT:8081}

node:
    mode: worker
    id: ${NODE_ID:worker-1}
    host: ${NODE_HOST:localhost}
    coordinator-url: ${COORDINATOR_URL:http://localhost:8080}
