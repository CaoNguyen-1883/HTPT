

services:
  # Coordinator Node (Node 1)
  coordinator:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: coordinator
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=coordinator
      - NODE_ID=node-1
      - NODE_HOST=coordinator
      - NODE_PORT=8080
    networks:
      - migration-network

  # Worker Node 2
  node2:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: node-2
    ports:
      - "8082:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=worker
      - NODE_ID=node-2
      - NODE_HOST=node2
      - NODE_PORT=8080
      - COORDINATOR_URL=http://coordinator:8080
    depends_on:
      - coordinator
    networks:
      - migration-network

  # Worker Node 3
  node3:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: node-3
    ports:
      - "8083:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=worker
      - NODE_ID=node-3
      - NODE_HOST=node3
      - NODE_PORT=8080
      - COORDINATOR_URL=http://coordinator:8080
    depends_on:
      - coordinator
    networks:
      - migration-network

  # Worker Node 4
  node4:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: node-4
    ports:
      - "8084:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=worker
      - NODE_ID=node-4
      - NODE_HOST=node4
      - NODE_PORT=8080
      - COORDINATOR_URL=http://coordinator:8080
    depends_on:
      - coordinator
    networks:
      - migration-network

  # Worker Node 5
  node5:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: node-5
    ports:
      - "8085:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=worker
      - NODE_ID=node-5
      - NODE_HOST=node5
      - NODE_PORT=8080
      - COORDINATOR_URL=http://coordinator:8080
    depends_on:
      - coordinator
    networks:
      - migration-network

  # Frontend
  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "3000:80"
    depends_on:
      - coordinator
    networks:
      - migration-network

networks:
  migration-network:
    driver: bridge
